# Unikalna nazwa projektu żeby uniknąć konfliktów z innymi aplikacjami
name: "transport-request-app"

services:
  # Usuwamy nginx kontener - bezpośrednie porty jak w Diet Calculator
  
  backend:
    build:
      context: .
      dockerfile: ./backend/Dockerfile
    ports:
      - "8010:8000"  # Zmiana na 8010 - powinien być wolny
    volumes:
      - "./backend/attachments:/app/attachments"
      - "./backend/data:/app/data"
      # Logs should be written inside container, not mounted from host
      # - "./backend/logs:/app/logs"
    environment:
      - ENV=production
      - PYTHONPATH=/app
      # Disable proxy for internal API
      - HTTP_PROXY=
      - HTTPS_PROXY=
      - NO_PROXY=your-url-address.com,localhost,127.0.0.1
      # Option 1: Token Manager (automatic token fetching from REST API)
      - RPA_BOT_PASSWORD=${RPA_BOT_PASSWORD:-}
      # Option 2: Manual SharePoint Access Token (fallback)
      - SHAREPOINT_ACCESS_TOKEN=${SHAREPOINT_ACCESS_TOKEN:-}
      # Debug Secret Key - optional, for maintenance access to logs
      - DEBUG_SECRET_KEY=${DEBUG_SECRET_KEY:-}
    restart: always

  frontend:
    build:
      context: .
      dockerfile: ./frontend/Dockerfile
      args:
        # REACT_APP_API_BASE_URL: https://your-url-address:5443
        REACT_APP_API_BASE_URL: https://your-url-address:8010
    ports:
      - "8002:3000"  # Zmiana z 8000 na 8001 - unikamy konfliktu z VM nginx
    environment:
      - NODE_ENV=production
    depends_on:
      - backend
    restart: always